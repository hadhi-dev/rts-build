import{K as me,V as xe,r as a,J as c,j as e,C as ue}from"./index-xBtzwtXX.js";import{S as B}from"./sweetalert2.esm.all-CAQlxK8Y.js";import{c as V}from"./config-BbshSSl6.js";import{a as ge,R as S,b as he,c as pe}from"./ApiService-Cx_nAUo6.js";import{P as fe}from"./PostAPI-Dm7qi3aC.js";import{G as be}from"./GetAPI-C0R9K2iB.js";import{C as j}from"./index-DZOtQWmo.js";import{L as Y}from"./list-todo-BTGBr7wk.js";import{C as je}from"./circle-check-D58zQj7p.js";import{C as Ne}from"./circle-dashed-BQWg3hbh.js";import{L as ye}from"./lock-QenSlHfA.js";import"./menu-JSQSkgTC.js";import"./house-CqsVPz4r.js";import"./award-JnFsHSuM.js";/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],ve=me("Upload",Ce),$e=({updateParams:H})=>{var E,_,O,K;const[J]=xe(),N=J.get("uuid"),[C,W]=a.useState(null),[I,Q]=a.useState(!0),[z,D]=a.useState(null),[l,q]=a.useState(null),[g,L]=a.useState(null),[X,$]=a.useState(!1),[v,P]=a.useState({}),[f,A]=a.useState(null),[M,F]=a.useState("course"),[h,k]=a.useState(0);localStorage.getItem("usid");const w=()=>{H({pg:"courses",uuid:void 0})},b=a.useCallback(async()=>{if(N)try{Q(!0),D(null);const s=await ge(N);console.log("courseResult",s),s!=null&&s.data&&(W(s.data),await Z(s.data))}catch(s){console.error("Failed to fetch courses",s),D("Failed to load course details")}finally{Q(!1)}},[N]),R=s=>s&&s.length>0&&s.every(t=>t.IsComplete===1),Z=async s=>{if(!s||!s.course||!s.tasks)return;const t=R(s.tasks),i=s.course.IsCertified===1;if(t&&!i)try{(await be(`update_iscertified/${N}`)).code===200&&(console.log("Course certified successfully"),c.success("ðŸŽ‰ Congratulations! Course certified!",{position:"top-right",autoClose:3e3}))}catch(r){console.error("Error updating certification:",r)}},ee=async s=>{try{$(!0);const t=await pe(s);console.log("mcqResult",t),t!=null&&t.data&&(L(t.data),P({}))}catch(t){console.error("Failed to fetch MCQ data",t),D("Failed to load MCQ questions")}finally{$(!1)}};a.useEffect(()=>{b()},[b]);const se=()=>{const s=`${V.API_URL}certificate/${N}`,t=document.createElement("a");t.href=s,t.target="_blank",t.rel="noopener noreferrer",document.body.appendChild(t),t.click(),document.body.removeChild(t)},te=async s=>{const t=await he(s.TaskID);q(t.data),setTimeout(()=>i(),300);const i=()=>{const r=document.documentElement;r.requestFullscreen?r.requestFullscreen():r.webkitRequestFullscreen?r.webkitRequestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.msRequestFullscreen&&r.msRequestFullscreen()};s.TaskType==="MCQ"?(ee(s.TaskID),F("mcq")):F("task")},T=a.useCallback(()=>{F("course"),q(null),L(null),A(null),P({}),k(0)},[]),re=s=>s.IsComplete===1?"Completed":s.Status==="open"?"Available":"Locked",ie=s=>{switch(s){case"Completed":return"bg-green-100 text-green-700";case"Available":return"bg-blue-100 text-blue-700";case"Locked":return"bg-gray-100 text-gray-500";default:return"bg-gray-100 text-gray-700"}},ne=(s,t,i)=>{if(t===0)return!0;for(let r=0;r<t;r++)if(i[r].IsComplete===0)return!1;return!0},oe=s=>{const t=s.target.files[0];if(t){if(t.size>5*1024*1024){c.error("File size must be less than 5MB",{position:"top-right",autoClose:3e3});return}if(t.type!=="application/pdf"){c.error("Only PDF files are allowed",{position:"top-right",autoClose:3e3});return}A(t),c.success("File uploaded successfully",{position:"top-right",autoClose:2e3})}},ae=async()=>{if(!f){c.warning("Please upload a file",{position:"top-right",autoClose:3e3});return}if((await B.fire({title:"Confirm Submission",text:"Are you sure you want to submit this assignment? You cannot change it after submission.",icon:"question",showCancelButton:!0,confirmButtonText:"Submit Assignment",cancelButtonText:"Cancel",confirmButtonColor:"#4f46e5",cancelButtonColor:"#6b7280"})).isConfirmed)try{const t=l.RegistrationIDPK,i=localStorage.getItem("uid"),r=f,m=l.TaskName,x=n.CourseName,o=new FormData;o.append("file",r),o.append("RegistrationIDPK",t),o.append("UserID",i),o.append("fileName",r.name),o.append("TaskName",m),o.append("courseName",x);const d=await(await fetch(V.API_URL+"uploadTask/",{method:"POST",body:o})).json();d.code===200?d.data.IsComplete&&(c.success("Assignment submitted successfully!",{position:"top-right",autoClose:3e3}),A(null),T(),await b()):c.error("Error submitting assignment: "+(d.message||"Unknown error"),{position:"top-right",autoClose:3e3})}catch(t){console.error("Error submitting task:",t),c.error("Error submitting assignment. Please try again.",{position:"top-right",autoClose:3e3})}},le=(s,t)=>{P(i=>({...i,[s]:t}))},ce=async()=>{var r;const s=((r=g==null?void 0:g.mcqs)==null?void 0:r.length)||0,t=Object.keys(v).length;if(t<s){c.warning(`Please answer all questions. ${t}/${s} answered.`,{position:"top-right",autoClose:3e3});return}if((await B.fire({title:"Confirm Final Submission",text:"Are you sure you want to submit your answers? No more changes can be made after submission.",icon:"question",showCancelButton:!0,confirmButtonText:"Submit Test",cancelButtonText:"Cancel",confirmButtonColor:"#10b981",cancelButtonColor:"#6b7280"})).isConfirmed)try{const m=g.mcqs.map(u=>({QuestionID:u.QuestionID,selectedOption:v[u.QuestionID]})),x=localStorage.getItem("uid"),o=l.RegistrationIDPK,{status:p,data:d}=await fe("mcq_submit",{data:{RegistrationIDPK:o,uid:x,TaskID:l.TaskID,submissionData:m}});if(p===200){const u=(d==null?void 0:d.data)||d,G=(u==null?void 0:u.correctAnswers)||(u==null?void 0:u.score)||s,de=(G/s*100).toFixed(1);c.success("Test submitted successfully!",{position:"top-right",autoClose:2e3}),await B.fire({title:"Test Submitted!",html:`<div class="text-center">
            <p class="text-lg font-semibold mb-2">Your Score</p>
            <p class="text-3xl font-bold text-green-600 mb-2">${G}/${s}</p>
            <p class="text-gray-600">${de}%</p>
          </div>`,icon:"success",confirmButtonText:"Back to Course",confirmButtonColor:"#4f46e5"}),T(),await b()}else c.error((d==null?void 0:d.message)||"Error submitting test",{position:"top-right",autoClose:3e3})}catch(m){console.error("Error submitting MCQ:",m),c.error("Error submitting test. Please try again.",{position:"top-right",autoClose:3e3})}};if(I)return e.jsxs("section",{children:[e.jsxs("button",{onClick:()=>w(),className:"mb-4 flex items-center font-medium text-indigo-600 transition-colors hover:text-indigo-800",children:[e.jsx(j,{size:16,className:"mr-1"}),"Back to Courses"]}),e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(S,{size:24,className:"animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading course details..."})]})]});if(z)return e.jsxs("section",{children:[e.jsxs("button",{onClick:()=>w(),className:"mb-4 flex items-center font-medium text-indigo-600 transition-colors hover:text-indigo-800",children:[e.jsx(j,{size:16,className:"mr-1"}),"Back to Courses"]}),e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("p",{className:"mb-4 text-red-600",children:z}),e.jsxs("button",{onClick:b,className:"mx-auto flex items-center gap-2 rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700",children:[e.jsx(S,{size:16}),"Try Again"]})]})]});if(!(C!=null&&C.course))return e.jsxs("section",{children:[e.jsxs("button",{onClick:()=>w(),className:"mb-4 flex items-center font-medium text-indigo-600 transition-colors hover:text-indigo-800",children:[e.jsx(j,{size:16,className:"mr-1"}),"Back to Courses"]}),e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-gray-600",children:"No course data found"})})]});const{course:n,tasks:U}=C,y=U?[...U].sort((s,t)=>s.TaskOrderNo-t.TaskOrderNo):[];if(M==="task"&&l)return e.jsxs("section",{children:[e.jsxs("button",{onClick:T,className:"mb-4 flex items-center font-medium text-indigo-600 transition-colors hover:text-indigo-800",children:[e.jsx(j,{size:16,className:"mr-1"}),"Back to Course"]}),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"mb-2 text-2xl font-bold text-gray-900",children:l.TaskName}),e.jsxs("div",{className:"mb-4 flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:["Task Code: ",l.TaskCode]}),e.jsx("span",{className:"inline-flex items-center rounded-md bg-blue-100 px-2 py-1 text-xs font-medium text-blue-800",children:l.TaskType})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"mb-3 text-lg font-semibold text-gray-800",children:"Description"}),e.jsx("p",{className:"leading-relaxed text-gray-700",children:l.ShortDescription})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-800",children:"Submit Assignment"}),e.jsxs("div",{className:"rounded-lg border-2 border-dashed border-gray-300 p-8 text-center transition-colors hover:border-indigo-400",children:[e.jsx(ve,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"font-medium text-indigo-600 hover:text-indigo-500",children:"Click to upload"}),e.jsx("span",{className:"text-gray-600",children:" or drag and drop"}),e.jsx("input",{type:"file",className:"hidden",accept:".pdf",onChange:oe})]})}),e.jsx("p",{className:"text-sm text-gray-500",children:"PDF files only, up to 5MB"}),f&&e.jsxs("div",{className:"mt-4 rounded-md border border-green-200 bg-green-50 p-3",children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:f.name}),e.jsxs("p",{className:"text-xs text-green-600",children:[(f.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsx("button",{onClick:ae,disabled:!f,className:"mt-6 w-full rounded-md bg-indigo-600 px-4 py-3 font-medium text-white transition-colors hover:bg-indigo-700 disabled:cursor-not-allowed disabled:bg-gray-300",children:"Submit Assignment"})]})]})})]});if(M==="mcq"&&l&&g){const s=((E=g.mcqs)==null?void 0:E.length)||0,t=(_=g.mcqs)==null?void 0:_[h],i=h===s-1,r=h===0;return e.jsxs("section",{className:"relative flex h-screen flex-col overflow-hidden bg-white",children:[e.jsxs("button",{onClick:T,className:"absolute left-0 top-4 flex items-center gap-1 px-4 py-2 font-medium text-indigo-600 transition-colors hover:text-indigo-800 z-10 text-sm",children:[e.jsx(j,{size:18}),"Back"]}),e.jsxs("div",{className:"flex flex-col h-full overflow-hidden pt-16 pb-4 px-4 pl-20",children:[e.jsxs("div",{className:"rounded-lg border border-indigo-100 bg-gradient-to-r from-indigo-50 to-purple-50 p-3 mb-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-sm font-bold text-gray-900",children:l.TaskName}),e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mt-1",children:l.ShortDescription})]}),e.jsxs("span",{className:"whitespace-nowrap rounded-full bg-indigo-600 px-3 py-1 text-xs font-semibold text-white flex-shrink-0",children:["Q ",h+1,"/",s]})]}),e.jsx("div",{className:"mt-2 h-1 w-full overflow-hidden rounded-full bg-gray-300",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-600 to-purple-600 transition-all duration-500",style:{width:`${(h+1)/s*100}%`}})})]}),X?e.jsxs("div",{className:"flex items-center justify-center flex-1",children:[e.jsx(S,{size:18,className:"animate-spin text-indigo-400 mr-2"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Loading..."})]}):t?e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 mb-6 flex-shrink-0",children:e.jsx("h2",{className:"text-base font-bold text-gray-900 leading-relaxed",children:t.question})}),e.jsx("div",{className:"grid grid-cols-2 gap-4 mb-6 flex-shrink-0",children:(O=t.options)==null?void 0:O.map((m,x)=>{const o=String.fromCharCode(65+x),p=v[t.QuestionID]===o;return e.jsx("label",{className:`cursor-pointer rounded-lg border-2 p-4 transition-all text-left min-h-24 flex items-center ${p?"border-indigo-500 bg-indigo-50":"border-gray-200 bg-gray-50 hover:border-indigo-400 hover:bg-indigo-50"}`,children:e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("input",{type:"radio",name:`question-${t.QuestionID}`,value:o,checked:p,onChange:()=>le(t.QuestionID,o),className:"h-5 w-5 cursor-pointer flex-shrink-0 accent-indigo-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:`font-bold text-sm ${p?"text-indigo-700":"text-gray-800"}`,children:[o,"."," "]}),e.jsx("span",{className:`text-sm leading-relaxed ${p?"text-indigo-600":"text-gray-700"}`,children:m})]})]})},x)})}),e.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-6 flex-shrink-0",children:(K=g.mcqs)==null?void 0:K.map((m,x)=>e.jsx("button",{onClick:()=>k(x),className:`h-8 w-8 rounded-full text-xs font-semibold transition-all ${x===h?"bg-indigo-600 text-white ring-2 ring-indigo-300":v[m.QuestionID]?"bg-green-500 text-white":"bg-gray-300 text-gray-700"}`,children:x+1},m.QuestionID))}),e.jsxs("div",{className:"flex gap-3 flex-shrink-0",children:[e.jsx("button",{onClick:()=>k(Math.max(0,h-1)),disabled:r,className:"flex-1 rounded-lg border-2 border-gray-300 px-4 py-3 text-sm font-semibold text-gray-700 transition-all hover:border-indigo-400 hover:bg-indigo-50 disabled:opacity-40 disabled:cursor-not-allowed",children:"â† Previous"}),i?e.jsx("button",{onClick:ce,className:"flex-1 rounded-lg bg-gradient-to-r from-green-500 to-emerald-600 px-4 py-3 text-sm font-semibold text-white transition-all hover:shadow-lg",children:"Submit"}):e.jsx("button",{onClick:()=>k(Math.min(s-1,h+1)),className:"flex-1 rounded-lg bg-gradient-to-r from-indigo-600 to-purple-600 px-4 py-3 text-sm font-semibold text-white transition-all hover:shadow-lg",children:"Next â†’"})]})]}):null]})]})}return e.jsxs("section",{children:[e.jsxs("button",{onClick:()=>w(),className:"mb-4 flex items-center font-medium text-indigo-600 transition-colors hover:text-indigo-800",children:[e.jsx(j,{size:16,className:"mr-1"}),"Back to Courses"]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:n.CourseName}),e.jsxs("div",{className:"mt-2 flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:["Code: ",n.CourseCode]}),e.jsxs("span",{children:["Department: ",n.Department]}),e.jsxs("span",{children:["Instructor: ",n.InstructorName]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:b,disabled:I,className:"flex items-center gap-2 rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-600 transition-colors hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx(S,{size:16,className:I?"animate-spin":""}),"Refresh"]})})]}),n.ShortDescription&&e.jsx("p",{className:"mb-2 text-gray-600",children:n.ShortDescription}),e.jsxs("details",{className:"mb-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-indigo-600",children:"View Full Description"}),e.jsx("div",{className:"mt-2 max-h-60 overflow-y-auto text-sm",dangerouslySetInnerHTML:{__html:n.Description||"<p>No full description available.</p>"}})]}),e.jsx("div",{className:"mb-6 rounded-lg border border-gray-200 bg-white p-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 text-sm md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Amount:"}),e.jsxs("span",{className:"ml-2",children:["$",n.Amount]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Course Status:"}),e.jsx("span",{className:`ml-2 inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${n.IsComplete?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:n.IsComplete?"Course Complete":"In Progress"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Payment:"}),e.jsx("span",{className:`ml-2 inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${n.IsPaid?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:n.IsPaid?"Paid":"Unpaid"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Certificate:"}),n.IsCertified?e.jsx("button",{onClick:se,className:"ml-2 inline-flex items-center rounded-md bg-blue-100 px-2 py-1 text-xs font-medium text-blue-700 transition-colors hover:bg-blue-200",children:"View Certificate"}):e.jsx("span",{className:"ml-2 inline-flex items-center rounded-full bg-gray-100 px-2 py-1 text-xs font-medium text-gray-700",children:"Not Available"})]})]})}),R(y)&&e.jsx("div",{className:"mb-6 rounded-lg border border-green-200 bg-green-50 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{size:24,className:"mr-3 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800",children:"All Tasks Completed! ðŸŽ‰"}),e.jsx("p",{className:"text-green-700",children:"Congratulations! You have successfully completed all course tasks."})]})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx(Y,{size:20,className:"text-gray-700"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Course Tasks"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",y.length," tasks)"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto rounded-lg border border-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-left text-sm font-medium text-gray-600",children:[e.jsx("th",{className:"border-b border-gray-200 p-4",children:"#"}),e.jsx("th",{className:"border-b border-gray-200 p-4",children:"Task Name"}),e.jsx("th",{className:"border-b border-gray-200 p-4",children:"Type"}),e.jsx("th",{className:"border-b border-gray-200 p-4",children:"Description"}),e.jsx("th",{className:"border-b border-gray-200 p-4",children:"Status"}),e.jsx("th",{className:"border-b border-gray-200 p-4",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:y.length>0?y.map((s,t)=>{const i=re(s),r=ne(s,t,y);return e.jsxs("tr",{className:"text-sm text-gray-800 hover:bg-gray-50",children:[e.jsx("td",{className:"p-4 font-medium",children:t+1}),e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium",children:s.TaskName}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Code: ",s.TaskCode]})]}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"inline-flex items-center rounded-md bg-gray-100 px-2 py-1 text-xs font-medium text-gray-800",children:s.TaskType})}),e.jsx("td",{className:"max-w-xs p-4",children:e.jsx("p",{className:"truncate",title:s.ShortDescription,children:s.ShortDescription})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${ie(i)}`,children:i})}),e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex items-center gap-2",children:s.IsComplete===1?e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx(je,{size:16,className:"mr-1"}),e.jsx("span",{className:"text-xs",children:"Completed"})]}):r?e.jsxs("button",{onClick:()=>te(s),className:"flex items-center rounded-md bg-indigo-500 px-3 py-1.5 text-xs font-medium text-white transition-colors hover:bg-indigo-600",children:[e.jsx(Ne,{size:14,className:"mr-1"}),"Open Task"]}):e.jsxs("div",{className:"flex items-center text-gray-400",children:[e.jsx(ye,{size:16,className:"mr-1"}),e.jsx("span",{className:"text-xs",children:"Locked"})]})})})]},s.TaskID)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"p-8 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Y,{size:48,className:"mb-2 text-gray-300"}),e.jsx("p",{children:"No tasks available for this course."})]})})})})]})})]})]})]})};export{$e as default};
