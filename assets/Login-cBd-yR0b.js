import{r as o,u as I,U as v,V as L,J as r,j as t,L as P}from"./index-DPmwzKAO.js";import{A as y}from"./CONSTANTS-W_7WszVf.js";import{G as C}from"./GetAPI-C0R9K2iB.js";import{l as D}from"./authUtils-Cl3aMeRo.js";import"./config-BbshSSl6.js";const F=()=>{const[l,c]=o.useState({username:"",password:""}),[f,n]=o.useState(!1),x=o.useRef(null),h=o.useRef(null),p=o.useRef(null),a=I(),{usid:u}=v(),[m]=L(),S=()=>{const e=localStorage.getItem("loginTime"),s=new Date().getTime(),d=1440*60*1e3;e&&s-e>d&&(localStorage.clear(),r.warning("Session expired. Please login again.",{position:"top-right",autoClose:2e3}),a("/login"))};o.useEffect(()=>{S(),u&&j(u);const e=m.get("phone"),s=m.get("password");e&&s&&(c({username:e,password:s}),b(e,s,!0))},[u,a,m]),o.useEffect(()=>{if(window.location.pathname==="/login"){const e=localStorage.getItem("uid"),s=localStorage.getItem("aid");e>0&&a("/home"),s==="true"&&!e&&a("/admin")}},[a]),o.useEffect(()=>{var e;(e=p.current)==null||e.focus()},[]);const j=async e=>{localStorage.clear();try{n(!0);const{data:s}=await C(`login/${e}`);s?(r.success("Login Successful",{autoClose:2e3}),localStorage.setItem("isLoggedIn","true"),localStorage.setItem("udt",JSON.stringify(s)),localStorage.setItem("uid",s.userID),localStorage.setItem("usid",e),localStorage.setItem("loginTime",new Date().getTime()),a("/home")):r.warning("Kindly login with your credentials",{autoClose:2e3})}catch(s){console.error("Error in direct login:",s)}finally{n(!1)}},b=async(e=l.username,s=l.password,d=!1)=>{if(!e||!s){d||r.error("Please enter both username and password.");return}try{n(!0);const g=await D({mobileNumber:e,password:s}),{code:N,message:w,data:i}=g;N===200?(r.success(w,{autoClose:2e3}),localStorage.clear(),localStorage.setItem("isLoggedIn","true"),localStorage.setItem("udt",JSON.stringify(i)),localStorage.setItem("uid",i.userID),localStorage.setItem("loginTime",new Date().getTime()),e==="7598548786"?(localStorage.setItem("aid","true"),localStorage.setItem("usid",i.usid),a("/admin")):(localStorage.setItem("usid",i.usid),a("/home"))):r.error(w,{autoClose:2e3})}catch(g){r.error("An error occurred: "+g.message,{autoClose:3e3})}finally{n(!1)}};return t.jsxs(t.Fragment,{children:[f&&t.jsx(P,{}),t.jsx("div",{className:"absolute inset-0 z-0 hidden overflow-hidden md:block",children:t.jsx("img",{src:`${y.BG_PRIMARY}`,alt:"background",className:"h-full w-full object-cover transition-opacity"})}),t.jsx("div",{className:"relative flex min-h-screen items-center justify-center",children:t.jsxs("div",{className:"relative z-10 w-full max-w-md p-8 md:p-12",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("a",{href:"/",children:t.jsx("img",{src:y.LOGO,alt:"Company Logo",className:"mx-auto w-40 md:w-48"})}),t.jsx("h2",{className:"mt-8 text-left text-lg font-semibold text-gray-800",children:"Sign in to your account"}),t.jsx("p",{className:"mb-4 text-left text-xs text-gray-600",children:"Welcome! Please fill in your username and password to log in."})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"username",className:"mb-2 block text-sm text-gray-600",children:"Mobile Number"}),t.jsx("input",{type:"number",id:"username",ref:p,placeholder:"Enter your mobile number",maxLength:12,tabIndex:"1",value:l.username,onChange:e=>c({...l,username:e.target.value}),onKeyUp:e=>{var s;e.key==="Enter"&&((s=h.current)==null||s.focus())},className:"w-full rounded-md border px-3 py-2 focus:border-blue-400 focus:ring focus:ring-blue-300"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"password",className:"mb-2 block text-sm text-gray-600",children:"Password"}),t.jsx("input",{type:"password",id:"password",placeholder:"Enter your password",ref:h,tabIndex:"2",value:l.password,onChange:e=>{const s=e.target.value;if(s.length>8){r.error("Password must be max 8 characters",{autoClose:2e3});return}c({...l,password:s})},onKeyUp:e=>{var s;e.key==="Enter"&&((s=x.current)==null||s.click())},className:"w-full rounded-md border px-3 py-2 focus:border-blue-400 focus:ring focus:ring-blue-300"}),t.jsx("p",{className:"mt-1 w-full text-end text-xs",children:t.jsx("a",{href:"/forget-password",className:"text-blue-600 hover:underline",children:"Forgot your password?"})})]}),t.jsx("button",{type:"button",ref:x,onClick:()=>b(),className:"w-full rounded-md bg-blue-700 px-4 py-2 text-white hover:bg-blue-600 focus:ring focus:ring-blue-300",children:f?"Logging in...":"Login"}),t.jsxs("p",{className:"mt-6 text-center text-sm text-gray-500",children:["Don't have an account yet?"," ",t.jsx("a",{href:"/register",className:"font-medium text-blue-600 hover:underline",children:"Sign up"})]})]})})]})};export{F as default};
