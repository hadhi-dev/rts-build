import{K as A,u as q,V as G,r as i,j as t,L as J,a4 as k,J as I}from"./index-xBtzwtXX.js";import{C as D}from"./Card-DAEKUoXm.js";import{S as u,P as O}from"./StatCard-Cl5rVSKT.js";import{R as V,d as K,g as Y}from"./ApiService-Cx_nAUo6.js";import{G as Q}from"./GetAPI-C0R9K2iB.js";import{S as W}from"./sweetalert2.esm.all-CAQlxK8Y.js";import{c as P}from"./config-BbshSSl6.js";import{B as X}from"./index-DZOtQWmo.js";import{L as Z}from"./list-todo-BTGBr7wk.js";import{A as ee}from"./award-JnFsHSuM.js";import{L as te}from"./lock-QenSlHfA.js";import"./menu-JSQSkgTC.js";import"./house-CqsVPz4r.js";/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],re=A("ClipboardList",se);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],S=A("Sparkles",ae),je=()=>{const g=q(),[p,oe]=G(),[o,M]=i.useState(null),[ne,L]=i.useState([]),[E,$]=i.useState([]),[b,h]=i.useState([]),[T,y]=i.useState(!1),[j,f]=i.useState(null),z=JSON.parse(localStorage.getItem("udt")),m=localStorage.getItem("usid"),C=localStorage.getItem("uid");i.useEffect(()=>{p.get("uuid")&&g("/home?pg=dashboard",{replace:!0})},[g,p]);const R=(e,r)=>{const s=new Date(e),a=new Date,n=r*60*60*1e3;return a-s>=n},U=(e,r)=>{if(!e||!r)return console.warn("Invalid date or hours:",{dateTime:e,hours:r}),null;try{const s=new Date(e),a=new Date;if(isNaN(s.getTime()))return console.warn("Invalid date format:",e),null;const n=parseInt(r);if(isNaN(n)||n<=0)return console.warn("Invalid course hours:",r),null;const c=n*60*60*1e3,x=a-s,d=c-x;if(d<=0)return null;const l=Math.floor(d/(1e3*60*60)),v=Math.floor(d%(1e3*60*60)/(1e3*60)),w=Math.floor(d%(1e3*60)/1e3);return{hours:l,minutes:v,seconds:w,formatted:`${l}h ${v}m ${w}s`}}catch(s){return console.error("Error calculating remaining time:",s),null}},_=(e,r,s)=>r?{bg:"bg-green-100",text:"text-green-700",label:"Certified"}:e?{bg:"bg-blue-100",text:"text-blue-700",label:"In Progress"}:s?{bg:"bg-amber-100",text:"text-amber-700",label:"Payment Pending"}:{bg:"bg-gray-100",text:"text-gray-700",label:"Not Started"},N=async()=>{y(!0),f(null);try{const e=await K(m);(e==null?void 0:e.code)===200?(M(e.data.analytics),L(e.data.tasks)):f("Failed to fetch dashboard analytics")}catch{f("Failed to fetch dashboard analytics")}finally{y(!1)}},B=async()=>{try{const e=await Y(m);$(e.data||[])}catch(e){console.error("Failed to fetch courses",e)}},F=async()=>{try{const e=await Q(`newcourse/${C}`);(e==null?void 0:e.code)===200&&e.data?h(e.data):h([])}catch(e){console.error("Failed to fetch new courses",e),h([])}},H=async e=>{if((await W.fire({title:"Enroll in Course",text:"Do you want to enroll in this course? You will be redirected to the payment page.",icon:"question",showCancelButton:!0,confirmButtonText:"Proceed to Payment",cancelButtonText:"Cancel",confirmButtonColor:"#4f46e5",cancelButtonColor:"#6b7280"})).isConfirmed)try{I.info("Redirecting to payment page...",{position:"top-right",autoClose:2e3});const s=`${P.API_URL}enroll/${e}/${m}`,a=document.createElement("a");a.href=s,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(s){console.error("Error processing enrollment:",s),I.error("Error processing enrollment. Please try again.",{position:"top-right",autoClose:3e3})}};return i.useEffect(()=>{N(),B(),F()},[m,C]),j?t.jsx("div",{className:"p-6 text-red-500",children:j}):t.jsxs("div",{style:{position:"relative"},children:[T&&t.jsx(J,{position:"absolute"}),t.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[t.jsxs("h1",{className:"mb-6 text-3xl font-bold text-gray-900",children:["Hello, ",z.username,"!"]}),t.jsxs("button",{onClick:N,className:"flex items-center gap-2 rounded-md border border-gray-300 px-3 py-1 text-sm text-gray-600 hover:bg-gray-100",children:[t.jsx(V,{size:16})," Refresh"]})]}),t.jsxs("div",{className:"mb-8 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4",children:[t.jsx(u,{title:"Total Courses",value:(o==null?void 0:o.totalCourses)??0,icon:t.jsx(X,{})}),t.jsx(u,{title:"Active Courses",value:(o==null?void 0:o.activeCourses)??0,icon:t.jsx(Z,{}),color:"yellow"}),t.jsx(u,{title:"Tasks Due",value:(o==null?void 0:o.tasksDue)??0,icon:t.jsx(re,{}),color:"red"}),t.jsx(u,{title:"Certificates",value:(o==null?void 0:o.certifiedCourses)??0,icon:t.jsx(ee,{}),color:"green"})]}),t.jsx("h2",{className:"mb-4 text-2xl font-bold text-gray-900",children:"My Courses"}),t.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:E.map((e,r)=>{const s=_(e.IsPaid,e.IsCertified,e.IsPaymentUnderProcess),a=parseInt(e.CourseCode)||0,n=e.created_datetime||e.CreatedDate||e.CreatedAt||e.created_at;r===0&&console.log("Course data sample:",{CourseName:e.CourseName,CourseCode:e.CourseCode,courseHours:a,dateField:n,IsCertified:e.IsCertified});const c=R(n,a),x=c?null:U(n,a);return e.IsCertified,t.jsxs(D,{className:"flex flex-col",children:[t.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.CourseName}),t.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${s.bg} ${s.text}`,children:s.label})]}),t.jsx("p",{className:"mb-4 line-clamp-2 text-sm text-gray-600",children:e.ShortDescription}),e.IsPaid&&t.jsx(O,{progress:e.completedPercentage||0}),t.jsxs("div",{className:"mt-4 mb-4 flex items-center justify-between text-xs text-gray-500",children:[t.jsxs("span",{children:[e.CompletedTask||0," of ",e.TotalTask||0," tasks completed"]}),t.jsx("span",{className:"text-gray-600 font-medium",children:e.InstructorName})]}),t.jsx("div",{className:"mt-auto flex flex-col gap-2",children:e.IsCertified?c?t.jsxs("button",{onClick:()=>{const d=`${P.API_URL}certificate/${e.UUID||e.id}`,l=document.createElement("a");l.href=d,l.target="_blank",l.rel="noopener noreferrer",document.body.appendChild(l),l.click(),document.body.removeChild(l)},className:"flex items-center justify-center gap-2 rounded-lg bg-green-600 px-3 py-2 text-xs font-semibold text-white transition-all hover:bg-green-700",children:[t.jsx(k,{size:14}),"Download Certificate"]}):t.jsxs(t.Fragment,{children:[t.jsxs("button",{disabled:!0,className:"flex items-center justify-center gap-2 rounded-lg bg-gray-300 px-3 py-2 text-xs font-semibold text-gray-600 cursor-not-allowed",title:"Certificate available after course duration",children:[t.jsx(te,{size:14}),"Certificate Locked"]}),x&&t.jsxs("div",{className:"rounded-lg bg-blue-50 p-2 text-center border border-blue-200",children:[t.jsx("p",{className:"text-xs text-blue-700 font-semibold",children:"Available in:"}),t.jsx("p",{className:"text-xs text-blue-600",children:x.formatted})]})]}):e.IsPaid?t.jsxs("button",{onClick:()=>g(`/home?pg=courseDetail&uuid=${e.UUID}`),className:"flex items-center justify-center gap-2 rounded-lg bg-indigo-600 px-3 py-2 text-xs font-semibold text-white transition-all hover:bg-indigo-700",children:[t.jsx(k,{size:14}),"Open Course"]}):t.jsx("button",{disabled:!0,className:"flex items-center justify-center gap-2 rounded-lg bg-amber-300 px-3 py-2 text-xs font-semibold text-amber-800 cursor-not-allowed",children:"Payment Pending"})})]},r)})}),b.length>0&&t.jsxs("div",{className:"mt-12",children:[t.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[t.jsx(S,{size:24,className:"text-amber-500"}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"New Courses Available"})]}),t.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:b.map((e,r)=>t.jsxs(D,{className:"border-2 border-amber-200 bg-gradient-to-br from-amber-50 to-white",children:[t.jsxs("div",{className:"mb-3 inline-flex items-center gap-2 rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-700",children:[t.jsx(S,{size:12}),"New"]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.CourseName}),t.jsxs("p",{className:"text-xs text-gray-500",children:["Code: ",e.CourseCode]})]}),t.jsx("p",{className:"mb-4 line-clamp-2 text-sm text-gray-600",children:e.ShortDescription}),t.jsxs("div",{className:"mb-4 space-y-2 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Department:"}),t.jsx("span",{className:"font-medium text-gray-800",children:e.Department})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Instructor:"}),t.jsx("span",{className:"font-medium text-gray-800",children:e.InstructorName})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Price:"}),t.jsxs("span",{className:"font-bold text-indigo-600",children:["â‚¹ ",e.Amount]})]})]}),t.jsx("button",{onClick:()=>H(e.CourseID||e.id),className:"w-full rounded-lg bg-gradient-to-r from-amber-500 to-orange-500 px-4 py-2 font-semibold text-white transition-all hover:shadow-lg hover:scale-105",children:"Enroll Now"})]},r))})]})]})};export{je as default};
